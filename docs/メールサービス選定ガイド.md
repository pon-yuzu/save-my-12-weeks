# メールサービス選定ガイド

作成日: 2026-01-04

## 現状

メール送信機能のコードは**実装済み**ですが、本番環境では `MAIL_MAILER=log` となっており、実際にはメールが送信されていません。

以下のメール機能が実装済みです：
- 30日講座の自動配信（毎時スケジューラー実行）
- 一斉配信（ブロードキャスト）
- セミナー申込確認メール
- ウェルカムメール

## サービス比較

### 1. Amazon SES（Simple Email Service）

| 項目 | 内容 |
|------|------|
| **料金** | $0.10/1,000通（非常に安価） |
| **無料枠** | EC2から送信の場合 62,000通/月無料 |
| **到達率** | 高い（適切に設定した場合） |

**メリット**
- 大量送信に最適（コスト最安）
- AWSの信頼性
- バウンス・苦情のハンドリング機能

**デメリット**
- 初期設定がやや複雑（サンドボックス解除申請が必要）
- AWSアカウントが必要
- 設定ミスでスパム判定されやすい

**実装の手間**: ★★★☆☆（中程度）
- AWSアカウント作成
- SESでドメイン認証（DNS設定）
- サンドボックス解除申請（1-2営業日）
- IAMユーザー作成・認証情報取得

**Laravel設定**
```env
MAIL_MAILER=ses
AWS_ACCESS_KEY_ID=your-access-key
AWS_SECRET_ACCESS_KEY=your-secret-key
AWS_DEFAULT_REGION=ap-northeast-1
```

---

### 2. Mailgun

| 項目 | 内容 |
|------|------|
| **料金** | $0.80/1,000通（Flexプラン） |
| **無料枠** | 5,000通/月（最初3ヶ月）、以降1,000通/月 |
| **到達率** | 高い |

**メリット**
- 設定が比較的簡単
- Laravel標準サポート
- 詳細な配信ログ・分析機能
- Webhook（バウンス通知など）

**デメリット**
- 無料枠が少ない（本格運用には課金必要）
- クレジットカード登録必須
- SESより高い

**実装の手間**: ★★☆☆☆（簡単）
- アカウント作成
- ドメイン追加・DNS設定
- API Key取得

**Laravel設定**
```env
MAIL_MAILER=mailgun
MAILGUN_DOMAIN=savemy12weeks.com
MAILGUN_SECRET=key-xxxxxxxxxxxxxxxx
MAILGUN_ENDPOINT=api.mailgun.net
```

**追加パッケージ**
```bash
composer require symfony/mailgun-mailer symfony/http-client
```

---

### 3. SendGrid

| 項目 | 内容 |
|------|------|
| **料金** | $19.95/月〜（50,000通） |
| **無料枠** | 100通/日（永久無料） |
| **到達率** | 非常に高い |

**メリット**
- 管理画面が使いやすい
- テンプレート機能が充実
- マーケティング機能も豊富
- 到達率が業界トップクラス

**デメリット**
- 無料枠が非常に少ない（100通/日）
- 有料プランは月額固定で高め
- 小規模には割高

**実装の手間**: ★★☆☆☆（簡単）
- アカウント作成
- API Key作成
- ドメイン認証（推奨）

**Laravel設定**
```env
MAIL_MAILER=smtp
MAIL_HOST=smtp.sendgrid.net
MAIL_PORT=587
MAIL_USERNAME=apikey
MAIL_PASSWORD=your-sendgrid-api-key
MAIL_ENCRYPTION=tls
```

---

### 4. Gmail SMTP

| 項目 | 内容 |
|------|------|
| **料金** | 無料 |
| **制限** | 500通/日（Google Workspaceは2,000通/日） |
| **到達率** | 中程度 |

**メリット**
- 完全無料
- 設定が簡単
- 小規模なら十分

**デメリット**
- 送信制限が厳しい（500通/日）
- ビジネス用途には不向き
- 独自ドメインからの送信に制限あり
- スパム判定されやすい

**実装の手間**: ★☆☆☆☆（最も簡単）
- Googleアカウントで「アプリパスワード」を生成するだけ

**Laravel設定**
```env
MAIL_MAILER=smtp
MAIL_HOST=smtp.gmail.com
MAIL_PORT=587
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=your-app-password
MAIL_ENCRYPTION=tls
```

---

## 推奨

| ユースケース | 推奨サービス |
|--------------|--------------|
| **テスト・開発段階** | Gmail SMTP |
| **小規模運用（〜1,000通/月）** | Mailgun（無料枠内） |
| **中規模運用（〜10,000通/月）** | Amazon SES |
| **大規模・マーケティング重視** | SendGrid |

### このプロジェクトの場合

登録者数と30日講座の配信を考慮すると：

- **登録者100人以下**: Gmail SMTP または Mailgun無料枠で十分
- **登録者100〜500人**: Mailgun または Amazon SES
- **登録者500人以上**: Amazon SES（コスト面で有利）

---

## 設定後の確認事項

1. **テストメール送信**
   ```bash
   php artisan tinker
   >>> Mail::raw('テスト', fn($m) => $m->to('test@example.com')->subject('テスト'));
   ```

2. **DNS設定の確認**
   - SPFレコード
   - DKIMレコード
   - DMARCレコード（推奨）

3. **スケジューラーの動作確認**
   ```bash
   php artisan schedule:run
   ```

---

## 実装済みのメール機能一覧

| 機能 | ファイル | 説明 |
|------|----------|------|
| 30日講座配信 | `app/Jobs/SendDailyCourseEmail.php` | 毎時実行、ユーザーの希望時間に送信 |
| 一斉配信 | `app/Jobs/SendBroadcastEmail.php` | 管理画面から手動送信 |
| ウェルカムメール | `app/Mail/NewsletterWelcome.php` | 登録時に送信 |
| セミナー確認 | `app/Mail/SeminarApplicationConfirmation.php` | 申込時に送信 |

---

## 次のステップ

1. クライアントにサービスを選んでもらう
2. 選択したサービスのアカウント作成
3. `.env` の設定更新
4. DNS設定（ドメイン認証）
5. テストメール送信で動作確認
6. 本番運用開始
