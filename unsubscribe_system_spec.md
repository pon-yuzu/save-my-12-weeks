# 配信停止システム 追加仕様書

## 概要

30日講座メルマガの配信停止フロー。単純な解除ではなく、ユーザーに「次に何をするか」を考えさせてから解除する設計。

---

## フロー

```
メール内の[配信停止]リンクをクリック
↓
配信停止ページ（確認 + 自由記述）
↓
自由記述を入力して[配信停止する]ボタン
↓
完了ページ（感謝メッセージ）
↓
配信停止処理完了
```

---

## 画面仕様

### 1. 配信停止ページ

**URL例**: `/unsubscribe/{token}`

**表示内容**:

```
ここまで読んでくれてありがとう。

やめる理由、なんとなくわかります。

無料だから。
続けられなくて嫌な気持ちになるから。
合わないと思ったから。
もっと合うものを見つけたから。

どれも、わかる。

でも一つだけ、知っておいてほしいことがあります。

無料のものは、どんなに質が高くても、私たちは軽く見てしまう。
だって財布が傷つかないから。

だから、もしあなたが
「タダのものはタダなりの価値しかない」
「無料の範囲では変われない」
って気づけたなら、どうか自分のために投資をしてください。

それが私じゃなくてもいいです。

私みたいに100万払った語学学校で
「いい経験になった」「まあ友達はできた」
なんて自己満足で終わらせないで。

成長や成果が出せると、あなたが信じられるものに。

---

**この30日の代わりに、何に投資しますか？**

[テキストエリア（必須入力）]

[配信停止する]ボタン
```

**バリデーション**:
- 自由記述欄は必須（空欄では送信不可）
- 最低文字数：なし（1文字でもOK）

---

### 2. 完了ページ

**URL例**: `/unsubscribe/complete`

**表示内容**:

```
ここまでありがとう。

私との出会いが、あなたの人生を少しでも良くするものであったことを願っています。

Sayaka
```

---

## データベース

### unsubscribe_reasons テーブル（新規作成）

| カラム | 型 | 説明 |
|--------|-----|------|
| id | bigint | PK |
| user_id | bigint | FK → users |
| reason | text | 自由記述の内容 |
| unsubscribed_at | timestamp | 配信停止日時 |

---

## 処理フロー

1. ユーザーがメール内の配信停止リンクをクリック
2. トークンからユーザーを特定し、配信停止ページを表示
3. ユーザーが自由記述を入力して送信
4. `unsubscribe_reasons`テーブルに記録
5. `mail_subscriptions`テーブルの`is_active`を`false`に更新
6. 完了ページを表示

---

## 備考

- 配信停止リンクはメールのフッターに設置
- トークンはユーザーごとにユニーク（推測不可能なもの）
- 自由記述の内容は管理画面から閲覧可能にする（ユーザーの声として活用）
